<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlayz - NFT Overlay Tool for Hedera</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Include Google Fonts (Open Sans) and local fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Required SDKs -->
    <script src="https://unpkg.com/@hashgraph/hedera-wallet-connect@0.2.0/dist/hedera-wallet-connect.js"></script>
    <script src="https://unpkg.com/@hashgraph/sdk@2.36.0/dist/browser-bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@hashgraph/hashconnect@3.8.0/dist/bundle.js"></script>
    <style>
      /* Try all possible variations of the font name for PhatBoi */
      @font-face {
        font-family: 'PhatBoi';
        src: local('CC Phat Boi'), 
             local('CCPhatBoi'),
             local('Phat Boi'),
             local('PhatBoi'),
             local('cc-phat-boi'),
             local('CC-Phat-Boi');
        font-weight: normal;
        font-style: normal;
      }
      
      @font-face {
        font-family: 'PhatBoi';
        src: local('CC Phat Boi Bold'), 
             local('CCPhatBoi Bold'),
             local('Phat Boi Bold'),
             local('PhatBoi Bold'),
             local('cc-phat-boi-bold'),
             local('CC-Phat-Boi-Bold');
        font-weight: bold;
        font-style: normal;
      }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>OVERLAYZ</h1>
            <h3>The Hedera NFT Overlay Tool</h3>
        </header>
        
        <main>
            <div class="wallet-section">
                <div class="wallet-connect">
                    <button id="connect-wallet-btn" class="connect-btn">Connect Wallet</button>
                    <div id="account-display" class="account-info" style="display: none;"></div>
                </div>
            </div>
            
            <div class="input-section">
                <div class="nft-section-header">
                    <h3>Your NFT Collections</h3>
                </div>
                
                <div id="collections-list" class="collections-container">
                    <!-- Collections will be loaded here -->
                </div>
            </div>
            
            <div class="nft-gallery" id="nft-gallery">
                <!-- NFT images will be displayed here -->
                <p class="gallery-placeholder">Connect your wallet to see your NFTs and apply overlays</p>
            </div>
            
            <div class="editor-container">
                <div class="editor-left">
                    <div class="nft-preview" id="nft-preview">
                        <!-- Selected NFT with overlays will display here -->
                        <div class="preview-placeholder">
                            <p>Select an NFT to start editing</p>
                        </div>
                    </div>
                    <div class="position-controls" id="position-controls" style="display: none;">
                        <div class="position-slider">
                            <label for="scale-slider">Size:</label>
                            <input type="range" id="scale-slider" min="0.5" max="1.5" step="0.1" value="1">
                        </div>
                        <div class="position-slider">
                            <label for="x-position">X Position:</label>
                            <input type="range" id="x-position" min="-50" max="50" value="0">
                        </div>
                        <div class="position-slider">
                            <label for="y-position">Y Position:</label>
                            <input type="range" id="y-position" min="-50" max="50" value="0">
                        </div>
                    </div>
                </div>
                
                <div class="editor-right">
                    <h3>Overlay Items</h3>
                    <div class="overlay-categories">
                        <button class="category-btn active" data-category="hats">Hats</button>
                        <button class="category-btn" data-category="glasses">Glasses</button>
                        <button class="category-btn" data-category="accessories">Accessories</button>
                    </div>
                    
                    <div class="overlay-items" id="overlay-items">
                        <!-- Overlay items will be displayed here -->
                    </div>
                    
                    <div class="editor-controls">
                        <button id="save-btn" disabled>Save Image</button>
                        <button id="reset-btn" disabled>Reset Overlays</button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>&copy; 2025 Overlayz from SLIME. All rights reserved.</p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-message">Loading...</p>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" style="display: none; position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.8); color: #fff; padding: 10px; max-width: 400px; max-height: 300px; overflow: auto; z-index: 9999; font-family: monospace; font-size: 12px;">
        <h4>Debug Console</h4>
        <div id="debug-content"></div>
    </div>

    <!-- Scripts -->
    <script src="js/wallet.js"></script>
    <script src="js/api.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const connectBtn = document.getElementById('connect-wallet-btn');
            const accountDisplay = document.getElementById('account-display');
            const loadingOverlay = document.getElementById('loading-overlay');
            
            // Loading overlay functions
            function showLoading(message = 'Loading...') {
                document.getElementById('loading-message').textContent = message;
                loadingOverlay.style.display = 'flex';
            }
            
            function hideLoading() {
                loadingOverlay.style.display = 'none';
            }

            // Error display function
            function showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ff4444; color: white; padding: 10px 20px; border-radius: 5px; z-index: 1000;';
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }
            
            // Setup wallet event handlers
            window.wallet.onEvent('connect', (account) => {
                connectBtn.textContent = 'Disconnect';
                accountDisplay.style.display = 'block';
                accountDisplay.textContent = `Connected: ${account}`;
                hideLoading();
                document.querySelector('.nft-gallery').classList.add('active');
                document.querySelector('.editor-container').classList.add('active');
            });

            window.wallet.onEvent('disconnect', () => {
                connectBtn.textContent = 'Connect Wallet';
                accountDisplay.style.display = 'none';
                accountDisplay.textContent = '';
                hideLoading();
                document.querySelector('.nft-gallery').classList.remove('active');
                document.querySelector('.editor-container').classList.remove('active');
            });

            // Initialize wallet
            try {
                showLoading('Initializing wallet connection...');
                await window.wallet.init();
                console.log('Wallet initialized successfully');
                hideLoading();
            } catch (error) {
                console.error('Failed to initialize wallet:', error);
                hideLoading();
                showError('Failed to initialize wallet. Please refresh and try again.');
            }

            // Connect/Disconnect button handler
            connectBtn.addEventListener('click', async () => {
                try {
                    connectBtn.disabled = true;
                    
                    if (window.wallet.isConnected()) {
                        showLoading('Disconnecting...');
                        await window.wallet.disconnect();
                    } else {
                        showLoading('Connecting...');
                        await window.wallet.connect();
                    }
                } catch (error) {
                    console.error('Wallet connection error:', error);
                    showError('Wallet connection failed. Please try again.');
                    hideLoading();
                } finally {
                    connectBtn.disabled = false;
                }
            });

            // Setup overlay category buttons
            const categoryButtons = document.querySelectorAll('.category-btn');
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    if (typeof updateOverlayItems === 'function') {
                        updateOverlayItems(button.dataset.category);
                    }
                });
            });
        });

        // Debug console
        (function() {
            const debugPanel = document.getElementById('debug-panel');
            const debugContent = document.getElementById('debug-content');
            
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                }
            });
            
            const oldLog = console.log;
            console.log = function(...args) {
                oldLog.apply(console, args);
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg);
                        } catch (e) {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                
                const logEntry = document.createElement('div');
                logEntry.textContent = '> ' + message;
                debugContent.appendChild(logEntry);
                debugContent.scrollTop = debugContent.scrollHeight;
            };
        })();
    </script>
</body>
</html>